<!-- chat/templates/chat/room.html -->
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Doctor Appointments Room</title>
  </head>
  <body>
    <textarea id="chat-log" cols="70" rows="70"> </textarea><br />
    {% comment %}
    <input id="chat-message-input" type="text" size="100" /><br />
    <input id="chat-message-submit" type="button" value="Send" />
    {% endcomment %} {{ doctor_id|json_script:"doctor-id" }}
    <script>
      const doctorId = JSON.parse(
        document.getElementById("doctor-id").textContent
      );

      const agapeSocket = new WebSocket(
        //"ws://" + window.location.host + "/ws/test/"
        "ws://" +
          window.location.host +
          "/ws/doctor/" +
          doctorId +
          "/notifications/"
      );

      agapeSocket.onmessage = function (e) {
        let data = JSON.parse(e.data);
        console.log(data.notification);
        document.querySelector("#chat-log").value = data.notification + "\n";

        if (data.notification) {
          console.log("New notification: ", data.notification.message);
        }
      };

      agapeSocket.onclose = function (e) {
        console.error("Chat socket closed unexpectedly");
      };
    </script>
  </body>
</html>
