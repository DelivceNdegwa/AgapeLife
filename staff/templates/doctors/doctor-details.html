<!-- All again -->
{% extends 'layouts/base.html' %}{% block title %}Dr {{
doctor.first_name}}{%endblock %} {% block content %}

<div class="container">
  <div class="row justify-content-center my-5">
    <div
      class="col-sm-6 item-rounded shadow p-2 d-flex flex-column text-center justify-content-around"
    >
      {% if doctor.profile_image %}
      <img
        src="{{doctor.profile_image.url}}"
        class="img-fluid item-rounded"
        style="object-fit: cover"
        height="90px"
        width="350px"
      />
      {% else %}
      <p>No profile image found</p>
      {% endif %}
    </div>

    <div class="col-sm-6 d-flex flex-column align-content-stretch">
      <div class="card item-rounded h-100">
        <div class="card-body">
          <div class="row mb-3 mt-2 mx-1">
            <h4>Doctor Details</h4>
            <h5 class="my-auto font-weight-bold">
              Name: Dr {{doctor.first_name}} {{doctor.last_name}}<br />
            </h5>

            <h6 class="font-weight-bold mt-2">Doctor Description</h6>
            <small class="mb-3">{{doctor.self_description|default:"No description provided"}}</small>
            <h6 class="font-weight-bold mt-2">Doctor Category</h6>
            <p>{{doctor.category.name}}</p>
            <h6 class="font-weight-bold mt-2">Doctor Specialization</h6>
            <p>{{ doctor.speciality }}</p>
            <h6 class="font-weight-bold mt-2">Current Hospital</h6>
            <p>{{ doctor.hospital }}</p>
            <p>Status:{% if doctor.is_verified %}Verified{% else %}Not verified{% endif %}</p>
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-6 mt-3">
      <div class="card item-rounded">
        <div class="card-body">
          <div class="row mb-3 mx-1">
            <h5 class="ml-3 my-auto font-weight-bold">Appointments</h5>
          </div>
          <table class="table table-striped table-sm-responsive">
            <thead>
              <tr>
                <td>Title</td>
                <td>Patient Name</td>
                <td>Time</td>
              </tr>
            </thead>
            <tbody>
              {% for appointment in doctor.appointment_set.all %}

              <tr id="appointment_id_{{appointment.id}}">
                <td>{{appointment.title}}</td>
                <td>
                  With {{ appointment.client.first_name }} {{appointment.client.first_name }}
                </td>
                <td>{{ appointment.end_time }}</td>
                <!-- <td>
                  <a href="#" class="btn btn-text-main btn-sm">
                    <i class="fa fa-eye"></i>
                  </a>
                </td> -->
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

      <div class="card item-rounded mt-3">
        <div class="card-body">
          <div class="row mb-3 mt-2 mx-1">
            <h5 class="my-auto font-weight-bold">Payment Details<br /></h5>
          </div>
          <hr />

          {% for method in business.method_set.all %}
          <h6 class="font-weight-bold">Payment Method:</h6>
          <p>{{method.type.getChoice}}</p>

          <h6 class="font-weight-bold">Financial Institution:</h6>
          <p>{{method.account_bank}} (Represents Bank or Mpesa Code)</p>

          <h6 class="font-weight-bold">Account Number / Phone Number:</h6>
          <p>{{method.details}}</p>

          <a href="#" class="btn btn-main">Update Details</a>

          {% empty %}
          <a href="#" class="btn btn-main">Add Payment Method</a>
          {% endfor %}
        </div>
      </div>
    </div>

    <div class="col-lg-6 mt-3">
      <div class="card item-rounded">
        <div class="card-body">
          <div class="row mb-3 mt-2 mx-1">
            <h5 class="my-auto font-weight-bold">Contacts <br /></h5>
          </div>
          <hr />
          <ul>
            <li>
              {{doctor.email}}
              <a
                href="mailto:{{doctor.email}}"
                class="btn btn-text-main btn-sm"
              >
                <i class="fa fa-envelope"></i>
              </a>
            </li>
            <li>
              +254{{doctor.phone_number}}
              <a
                href="tel:{{doctor.phone_number}}"
                class="btn btn-text-main btn-sm"
              >
                <i class="fa fa-phone"></i>
              </a>
            </li>
          </ul>
        </div>
      </div>

      {% if doctor.license_certificate %}

      <div class="card item-rounded mt-2">
        <div class="card-body">
          <h5 class="font-weight-bold">Attachments</h5>

          <a
            class="btn btn-success"
            href="{{ doctor.license_certificate.url }}"
            download="{{doctor.license_certificate.url}}"
            >Download medical licence</a
          >
          <br />
        </div>
      </div>

      {% endif %}

      <div class="d-flex flex-row justify-content-end mt-4">
        {% if doctor.is_verified %}

        <a
          href="#unverify"
          data-verified="{{ doctor.is_verified }}"
          data-url="{% url 'unverify-doctor' doctor.id %}"
          class="unverify-doc btn btn-outline-danger"
        >
          Unverify Doctor
        </a>

        {% else %}
        <a
          href="#verify"
          data-verified="{{ doctor.is_verified }}"
          class="verify-doc btn btn-success"
          data-url="{% url 'verify-doctor' doctor.id %}"
        >
          Verify Doctor
        </a>

        {% endif %}
      </div>
    </div>
  </div>
</div>

{% endblock %} {% block scripts %}

<script>
  function deactivateUserAccount(user, id) {
    $.ajaxSetup({
      headers: {
        "X-CSRFToken": $('meta[name="csrf-token"]').attr("content"),
      },
    });

    if (confirm("Are you sure you want to update this account's status?")) {
      $("#btnDeactivate").html("<i class='fa fa-spinner fa-spin'></i>");

      $.ajax({
        url: "{% url 'deactivate.account' %}",
        type: "POST",
        data: {
          user: user,
          id: id,
        },
        dataType: "json",
        success: function (data) {
          if (data["success"] == 1) {
            $("#btnDeactivate")
              .html("Status Changed")
              .removeClass("btn-outline-danger")
              .addClass("btn-main");

            setTimeout(function () {
              window.location.reload();
            }, 1000);
          } else {
          }
        },
        error: function (data) {
          console.log(data);
        },
      });
    }
  }
</script>

{% endblock %}

<!-- Previous code -->
<!-- 
{% if doctor.is_verified %}

<a
  href="#unverify"
  data-verified="{{ doctor.is_verified }}"
  data-url="{% url 'unverify-doctor' doctor.id %}"
  class="unverify-doc btn btn-sm btn-danger w-100"
  ><i class="m-2 fa fa-times-circle"></i> Unverify</a
>{% else %}

<a
  href="#verify"
  data-verified="{{ doctor.is_verified }}"
  class="verify-doc btn btn-sm btn-success w-100"
  data-url="{% url 'verify-doctor' doctor.id %}"
  ><i class="m-2 fa fa-check-circle"></i> Verify</a
>
{% endif %} {% if doctor.license_certificate %}
<a
  href="{{ doctor.license_certificate.url }}"
  download="{{ doctor.license_certificate.url }}"
  >Download License</a
>
{% endif %}

 -->
